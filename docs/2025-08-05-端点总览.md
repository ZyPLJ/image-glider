# ImageGlider WebApi 端点总览

基于 ImageConverter.cs 类，实现了完整的 RESTful 风格图片操作接口。以下是所有可用的端点：

## 1. 原有端点

### 图片格式转换
- `POST /api/upload` - 上传图片并转换格式
- `POST /api/dowloads/{fileName}` - 下载转换后的图片

## 2. 新增图片操作端点

### 图片尺寸调整 (`/api/resize`)
- `POST /api/resize/` - 调整图片尺寸
  - 参数：`file`, `width`, `height`, `resizeMode` (Stretch/KeepAspectRatio/Crop), `quality`
  
- `POST /api/resize/thumbnail` - 生成缩略图
  - 参数：`file`, `maxSize`, `quality`

### 图片裁剪 (`/api/crop`)
- `POST /api/crop/` - 精确裁剪图片
  - 参数：`file`, `x`, `y`, `width`, `height`, `quality`
  
- `POST /api/crop/center` - 中心裁剪图片
  - 参数：`file`, `width`, `height`, `quality`
  
- `POST /api/crop/percent` - 按百分比裁剪图片
  - 参数：`file`, `xPercent`, `yPercent`, `widthPercent`, `heightPercent`, `quality`

### 图片压缩 (`/api/compress`)
- `POST /api/compress/` - 压缩优化图片
  - 参数：`file`, `compressionLevel` (1-100), `preserveMetadata`

### 图片水印 (`/api/watermark`)
- `POST /api/watermark/text` - 添加文本水印
  - 参数：`file`, `text`, `position`, `opacity`, `fontSize`, `fontColor`, `quality`
  - 位置选项：TopLeft, TopCenter, TopRight, MiddleLeft, Center, MiddleRight, BottomLeft, BottomCenter, BottomRight
  
- `POST /api/watermark/image` - 添加图片水印
  - 参数：`file`, `watermarkFile`, `position`, `opacity`, `scale`, `quality`

### 元数据清理 (`/api/metadata`)
- `POST /api/metadata/strip` - 清理图片元数据
  - 参数：`file`, `stripAll`, `stripExif`, `stripIcc`, `stripXmp`, `quality`

### 颜色调整 (`/api/color`)
- `POST /api/color/adjust` - 调整图片颜色
  - 参数：`file`, `brightness` (-100到100), `contrast` (-100到100), `saturation` (-100到100), `hue` (-180到180), `gamma` (0.1到3.0), `quality`

### 图片信息 (`/api/info`)
- `POST /api/info/` - 获取图片信息
  - 参数：`file`
  - 返回：图片的详细信息（尺寸、格式、元数据等）

## 3. 响应格式

所有端点都返回统一的响应格式：

```json
{
    "statusCode": 200,
    "successful": true,
    "message": "操作成功",
    "data": "处理后的文件名或图片信息"
}
```

错误响应：
```json
{
    "statusCode": 400,
    "successful": false,
    "message": "错误描述",
    "data": null
}
```

## 4. 使用说明

### 基本用法
所有端点都接受 multipart/form-data 格式的请求，主要参数为：
- `file`: 要处理的图片文件（必需）
- 其他参数根据具体操作而定（可选，有默认值）

### 示例请求

#### 调整图片尺寸
```bash
curl -X POST "http://localhost:5000/api/resize/" \
  -F "file=@image.jpg" \
  -F "width=800" \
  -F "height=600" \
  -F "resizeMode=KeepAspectRatio" \
  -F "quality=90"
```

#### 添加文本水印
```bash
curl -X POST "http://localhost:5000/api/watermark/text" \
  -F "file=@image.jpg" \
  -F "text=Sample Watermark" \
  -F "position=BottomRight" \
  -F "opacity=50" \
  -F "fontSize=24" \
  -F "fontColor=#FFFFFF"
```

#### 裁剪图片
```bash
curl -X POST "http://localhost:5000/api/crop/" \
  -F "file=@image.jpg" \
  -F "x=100" \
  -F "y=100" \
  -F "width=400" \
  -F "height=300"
```

## 5. 技术实现

- **框架**: ASP.NET Core Minimal APIs
- **图片处理**: 基于 ImageConverter.cs 类的静态方法
- **文件处理**: 使用 IFileService 进行文件上传、保存和清理
- **错误处理**: 统一的异常捕获和错误响应
- **日志记录**: 记录操作成功和失败信息

## 6. 扩展性

所有端点都实现了 IEndpoint 接口，便于：
- 统一的端点注册和服务配置
- 模块化的代码组织
- 便于测试和维护
- 支持端点的独立部署和扩展